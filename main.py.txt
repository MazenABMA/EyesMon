# main.py

import time
import json
from simulator.device_simulator import generate_hospital_rooms
from monitor.cli_monitor import poll_cli_device
from alert.alert_manager import check_alerts
from alert.alert_manager import log_event

# Step 1: Generate hospital map
hospital = generate_hospital_rooms()

# Step 2: Show room selection
print("üè• Available Rooms in Hospital:\n")
for room in hospital:
    print(f"  {room}")
room_input = input("\nüîç Enter a room number to monitor (e.g., 1): ")

# Convert to proper key
room_choice = f"Room {room_input}"

if room_choice not in hospital:
    print("‚ùå Invalid room choice.")
    exit(1)

devices = hospital[room_choice]
print(f"\nüì° Monitoring devices in {room_choice}...\n")

# Step 3: Real-time loop
while True:
    print("Polling devices...\n")
    for device in devices:
        metrics = poll_cli_device(device)
        check_alerts(device, metrics)
    print("Sleeping 10 seconds...\n")
    time.sleep(10)